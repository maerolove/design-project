# Frontend Contract - ESPHome Configuration Editor

## Основные требования

### 1. Автоматическая загрузка дефолтной конфигурации

**КРИТИЧЕСКОЕ ТРЕБОВАНИЕ**: При открытии главной страницы ДОЛЖНА автоматически загружаться дефолтная валидная конфигурация! Не нужно нажимать "New Config"!

#### Детали:
- При загрузке страницы `/` в YAML редакторе должен автоматически появляться валидный конфиг
- Конфиг должен содержать базовые поля: `esphome:`, `name:`, `platform:`, `board:`
- Пользователь должен сразу видеть готовую к использованию конфигурацию
- Кнопка "New Config" должна быть дополнительной опцией, а не обязательной

#### Пример дефолтной конфигурации:
```yaml
esphome:
  name: my-device
  platform: ESP32
  board: esp32dev

wifi:
  ssid: "MyWiFi"
  password: "MyPassword"

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: "your-encryption-key-here"

ota:
  password: "your-ota-password-here"

web_server:
  port: 80
```

### 2. Состояния системы

#### Валидация:
- `VALIDATING` - конфигурация проверяется
- `VALID` - конфигурация валидна
- `INVALID` - конфигурация содержит ошибки

#### Компиляция:
- `COMPILING` - конфигурация компилируется
- `COMPILED` - компиляция завершена успешно
- `COMPILATION_FAILED` - ошибка компиляции

### 3. API интеграция

#### Endpoints:
- `POST /validate` - валидация конфигурации
- `POST /compile` - компиляция конфигурации
- `GET /health` - проверка состояния системы
- `GET /cache/stats` - статистика кэша

#### Headers:
- `X-Current-State` - текущее состояние системы
- `Content-Type: application/json` - для API запросов

### 4. Пользовательский интерфейс

#### Обязательные элементы:
- YAML редактор с подсветкой синтаксиса
- Кнопка "Validate" для проверки конфигурации
- Кнопка "Compile" для компиляции
- Отображение текущего состояния системы
- Отображение ошибок валидации/компиляции

#### Дополнительные элементы:
- Кнопка "New Config" для создания новой конфигурации
- Кнопка "Save" для сохранения конфигурации
- Кнопка "Load" для загрузки существующей конфигурации

### 5. Обработка ошибок

#### Валидация:
- Ошибки должны отображаться в понятном формате
- Указание строки и позиции ошибки
- Предложения по исправлению

#### Компиляция:
- Отображение прогресса компиляции
- Детальная информация об ошибках
- Возможность скачать лог компиляции

### 6. Производительность

#### Требования:
- Загрузка страницы < 2 секунд
- Валидация конфигурации < 1 секунды
- Компиляция конфигурации < 30 секунд
- Отзывчивый интерфейс при всех операциях

### 7. Совместимость

#### Браузеры:
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

#### Устройства:
- Desktop (1920x1080+)
- Tablet (768x1024+)
- Mobile (375x667+)

## Тестирование

### E2E тесты:
- `basic-loading.spec.cjs` - проверка загрузки дефолтной конфигурации
- `validation.spec.cjs` - проверка валидации
- `compilation.spec.cjs` - проверка компиляции

### Критерии успеха:
- ✅ Главная страница загружается с дефолтной конфигурацией
- ✅ Валидация работает корректно
- ✅ Компиляция работает корректно
- ✅ Состояния системы отображаются правильно
- ✅ Ошибки обрабатываются корректно

## Примечания

Этот контракт определяет обязательные требования для фронтенда. Любые изменения должны соответствовать этим требованиям и проходить все тесты.
